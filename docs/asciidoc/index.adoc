= The two layer structure

At the highest level, the diagram is rendered in two layers:
the lifeline layer and the message layer.

....
<div class="sequence-diagram">
    <div class="life-line-layer absolute h-full">
    </div>
    <div class="message-layer">
    </div>
</div>
....

== Key classes
=== .absolute
The `absolute` class is used to remove the lifeline layer from the normal
flow of the document.

=== .h-full
The `h-full` class is used to make the lifeline layer as tall as the parent
element. The parent element get the height from the `message-layer`.

== The message layer

=== Occurrence
_TODO_: explain misalignment of the occurrence concept and the spec.

image::images/occurrence.png[width=304,alt="occurrence"]

The occurrence is the bar (or invisible bar for async messages) that
represents the execution of a message.

It has a width of 15px and border of 2px. These two values #must not#
be overridden in themes.

It has a padding-left of 5px which pushes the children `interaction` to
the middle of the occurrence.
....
(occurrenceWidth - occurrenceBorderWidth x 2 - lifelineWidth) / 2
= (15 - 2 x 2 - 1) / 2
= 5
....

Because the lifeline has width of 1px, for normal (left to right) `interaction` s
we give it a margin left of 1px to avoid the overlap of the lifeline and the
interaction border. See `interaction` for more details.

=== Interaction
The `interaction` is one of the key conceptual elements. It works with
the `occurrence` to influence high-level layout. The `interaction` is the container
of the message, children interactions and the response.

The `interaction` has a border of 5px. This value #must not# be overridden in themes.
....
(occurrenceWidth - occurrenceBorderWidth x 2 - lifelineWidth) / 2
= (15 - 2 x 2 - 1) / 2
= 5
....

==== Do not add margin to interaction
It is on purpose that interaction box overlaps source lifeline but not the target
lifeline. Do not add #margin# to interaction components. This margin will cause
interaction's right board overlaps target lifeline and that is accumulative.

==== Debugging
Disable transparency of the interaction borders.

=== Common features among Interaction, Interaction and Creation

All the three work as a container for the message, children interactions and the
response. In the normal direction (left to right), they start with the middle
of the source lifeline and end with the middle of the target lifeline.


=== Message arrow
.Message arrow (the dashed line and arrow head)
image::images/creation-component.png[width=224]

This time we focus on how to align the arrow line and the arrow head.
We use a similar approach as pattern #vertically aligning# with pattern
#shift half the height#. Instead of `items-center` we use `items-end`.
Then we use `translate-y-1/2` to shift the arrow head down half the
height of the arrow head. (See Message.vue)
....
  <div class="message flex items-end"
    <div class="name flex-grow" style="padding-left: 10px">{{content}}</div>
    <point class="flex-shrink-0 transform translate-y-1/2 -my-px" :fill="fill" :rtl="rtl"/>
  </div>
....

==== Key classes
===== .flex .items-end
The `flex` and `items-end` classes are used to align the arrow line
and the arrow head at the bottom of the message.

===== .flex-grow
The `flex-grow` class is used to make the message name grow to fill
the available space.

===== .flex-shrink-0
The `flex-shrink-0` class is used to make the arrow head not shrink
when the message name is too long.

===== .transform .translate-y-1/2
The `transform` and `translate-y-1/2` classes are used to shift the
arrow head down half the height of the arrow head.

=== Message arrow right to left
image::images/message-arrow-rtl.png[width=200,alt="message arrow right to left"]

....
  <div class="message flex items-end" :class="{'flex-row-reverse': rtl}">
    <div class="name flex-grow"
          >{{content}}</div>
    <point class="flex-shrink-0 transform translate-y-1/2 -my-px"/>
  </div>
....

==== Key classes
===== .flex-row-reverse
The `flex-row-reverse` class is used to reverse the order of the name and
the arrow head.

=== Creation

image::images/creation-component.png[width=240]



==== Pattern 1: Vertically aligning
image::images/vertical-alignment.svg[width=40]

....
<div class="flex items-center">
  <div class="w-10 h-8 bg-blue-200"></div>
  <div class="w-10 h-20 bg-green-200"></div>
</div>
....

==== Pattern 2: Shift half the height
image::images/shift-up-half-the-height.png[width=50]

The message arrow is supposed to point to the middle of the participant
box. It is not he whole message that is aligned with the participant
box. So we have to shift the message up half the height of the message.
....
<div class="flex items-center m-10">
  <div class="w-10 h-8 bg-blue-200 transform -translate-y-1/2"></div>
  <div class="w-10 h-20 bg-green-200"></div>
</div>
....

This pattern is also used at the arrows. See the image for creation.

=== Creation right to left
image::images/creation-rtl.png[width=240,alt="creation right to left"]

On top of normal Creation, we need to flip the participant placeholder
and the message container. We use the `flex-row-reverse` class to flip.
See "Message right to left" for example using `flex-row-reverse`.


