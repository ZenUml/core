<template>
  <div class="statement">
    <div @click="showCollapse = !showCollapse; notShowCollapse = !showCollapse" class="button">
      <i class="fa"
         :class="{'fa-compress': showCollapse, 'fa-expand': !showCollapse}" aria-hidden="true"></i></div>
    <component v-if="showCollapse" v-bind:is="subStatement"
               :context="context"
               :from="from"
               :comment="comment"
               :offset="offset"></component>
    <label v-if="notShowCollapse">
      ...
    </label>

  </div>
</template>

<script>
  import Creation from './Creation.vue'
  import Interaction from './Interaction.vue'
  import InteractionAsync from './Interaction-async.vue'
  import SelfInteraction from './SelfInteraction.vue'
  import SelfInteractionAsync from './SelfInteraction-async.vue'
  import FragmentAlt from './FragmentAlt.vue'
  import FragmentLoop from './FragmentLoop.vue'

  export default {
    name: 'statement',
    props: ['from', 'context', 'offset'],
    data: function() {
      return {
        showCollapse: true,
        notShowCollapse: false
      }
    },
    computed: {
      comment: function () {
        return this.context.comment() ? this.context.comment().COMMENT().join('<br/>') : ''
      },
      subStatement: function () {
        let that = this
        let dict = {
          loop: 'FragmentLoop',
          alt: 'FragmentAlt',
          creation: 'Creation',
          message: function () {
            let isSelf = !that.context.message().func().to() || that.context.message().func().to().getCode() === that.from
            return isSelf ? 'SelfInteraction' : 'Interaction'
          },
          asyncMessage: function () {
            let isSelf = that.context.asyncMessage().source().getCode() === that.context.asyncMessage().target().getCode()
            return isSelf ? 'SelfInteractionAsync' : 'InteractionAsync'
          }
        }
        let key = Object.keys(dict).find(x => that.context[x]() !== null)
        let dictElement = dict[key]
        return typeof dictElement === 'function' ? dictElement() : dictElement
      }
    },
    components: {
      Creation,
      Interaction,
      InteractionAsync,
      SelfInteraction,
      SelfInteractionAsync,
      FragmentAlt,
      FragmentLoop
    }
  }
</script>
<style>
  .statement .button {
    display: none;
    /*position: absolute;*/
    background-color: transparent;
    border-color: transparent;
    color: #aaaaaa;
    z-index: 10000;
  }

  .statement:hover>.button {
    display: block;
    position: absolute;
    z-index: 10000;
  }

  .statement .card {
    width: 200px;
    background-color: transparent;
  }
  .statement .card-body {
    padding: 5px 20px;
  }
  .comments {
    position: relative; /* for Z axis position overlay lifeline at root level */
    text-align: left;
    border: solid 1px transparent;
    background: white;
    padding: 5px;
    width: 500px;
    font-size: 0.8em;
    font-style: italic;
    line-height: 1em;
    opacity: 0.5;
  }

  .comments:hover {
    color: black;
  }

  .fragment>.comments {
    width: 100%;
    border-bottom: solid 1px gray;
    border-top: none;
    border-left: none;
    border-right: none;
  }
</style>
